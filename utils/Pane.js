import{record as v}from"./common.js";import{jsonCopy as m}from"../snowpack/pkg/ish-utils/common.js";import p from"./bokalSourage.js";import u from"./qs.js";export function Presets({pane:r,folder:o=r,defaultPresets:l,defaultPresetName:a}){const c={[a]:{},...p.get("presets"),...l};let n=u.get("preset")||a;c.hasOwnProperty(n)||(n=a);const e={list:c,current:n,save(){const t=r.exportPreset(),s=window.prompt("Preset name: ",i.value);if(!!s){if(l.hasOwnProperty(s))return alert("Please, select another name :) You can't save with the same name as pre-installed preset. ");e.list[s]=t,e.current=s,i.value=s,i.options=[{text:s,value:s},...i.options],this.saveLocal(s,t)}},saveLocal(t,s){p.set("presets",{...p.get("presets"),...t&&s?{[t]:s}:null}),u.set("preset",i.value)},remove(){const t=i.value;t!==a&&(i.value=a,delete e.list[t],this.saveLocal())}};window.onbeforeunload=()=>e.saveLocal();const i=o.addBlade({label:"Presets",view:"list",options:Object.keys(e.list).map(t=>({text:t,value:t})).reverse(),value:e.current}).on("change",({value:t})=>{r.importPreset(m(e.list[t])),e.saveLocal()});return o.addButton({title:"Save preset"}).on("click",()=>e.save()),o.addButton({title:"Delete preset"}).on("click",()=>e.remove()),e}export function SketchControls(r,o,l){r.addButton({title:"Save PNG [S]"}).on("click",()=>o.savePng());const a=r.addButton({title:"Pause [Space]"}).on("click",()=>{o.pause=!o.pause,a.title=o.pause?"Play":"Pause"});r.addButton({title:"Restart [/]"}).on("click",l);const c=r.addButton({title:"Record [Q]"}).on("click",e);let n;function e(){n?(n.stop(),n=null):n=v(o.$canvas),c.title=n?"Stop rec [Q]":"Record [Q]"}return{toggleRecording:e}}
