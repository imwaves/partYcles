export default class o{constructor(i){const{real:e,parent:t,filter:a,padding:c=0,alpha:s=!1,smoothing:h=!1}=i;this.opts=i,e||!window.OffscreenCanvas?(this.$canvas=document.createElement("canvas"),document.body.appendChild(this.$canvas)):this.$canvas=new OffscreenCanvas(t.$canvas.width,t.$canvas.height),this.$canvas.width=(t?.$canvas.width||width)+c*2,this.$canvas.height=(t?.$canvas.height||height)+c*2,this.ctx=this.$canvas.getContext("2d",{alpha:s}),this.ctx.imageSmoothingEnabled=!!h,h&&(this.ctx.imageSmoothingQuality=h),this.ctx.filter=a||"none"}get width(){return parent?.$canvas.width||this.opts.width}get height(){return parent?.$canvas.height||this.opts.height}clear(i="black"){if(i===!0){this.ctx.clearRect(0,0,this.$canvas.width,this.$canvas.height);return}this.ctx.rect(0,0,this.$canvas.width,this.$canvas.height);const e=this.ctx.fillStyle,t=this.ctx.filter;this.ctx.fillStyle=i,this.ctx.filter="none",this.ctx.fill(),this.ctx.fillStyle=e,this.ctx.filter=t}putImage(i,e,t="source-over"){const a=this.opts.padding||0,{width:c,height:s}=i.$canvas;if(this.$canvas.width!==c+a*2||this.$canvas.height!==s+a*2){const h=this.ctx.getImageData(0,0,this.$canvas.width,this.$canvas.height);this.$canvas.width=c+a*2,this.$canvas.height=s+a*2,this.ctx.filter="none",this.ctx.putImageData(h,0,0)}this.ctx.filter=e||"none",this.ctx.globalCompositeOperation=t,this.ctx.drawImage(i.$canvas,0,0,c,s),this.ctx.globalCompositeOperation="source-over",this.ctx.filter="none"}letThrough(i,e,t){const a=this.opts.parent,c=this.opts.padding||0,{width:s,height:h}=a.$canvas;if(this.$canvas.width!==s||this.$canvas.height!==h){const n=this.ctx.getImageData(0,0,this.$canvas.width,this.$canvas.height);this.$canvas.width=s,this.$canvas.height=h,this.ctx.filter="none",this.ctx.putImageData(n,0,0)}this.ctx.filter=i||"none",this.ctx.globalCompositeOperation=e||"source-over",this.ctx.drawImage(a.$canvas,0,0,s,h),t&&t(this),a.ctx.drawImage(this.$canvas,0,0,s,h)}}
