const r=window.localStorage;class h{constructor(t){this._cbs={},this.prefix=t,window.addEventListener("storage",e=>{const{key:s,newValue:i}=e;if(!~s.indexOf(this.prefix))return;const c=JSON.parse(i),o=s.replace(this.prefix,""),n=this._cbs[o];!n||n.forEach(u=>u(c))})}has(t){return r.getItem(`${this.prefix}${t}`)!==null}set(t,e){return r.setItem(`${this.prefix}${t}`,JSON.stringify(e)),e}get(t){try{const e=r.getItem(`${this.prefix}${t}`);return e==="undefined"?null:JSON.parse(e)}catch(e){return null}}wipe(){const t=[];Object.keys(r).forEach(e=>{e.indexOf(this.prefix)===0&&(t.push(e),r.removeItem(e))}),window.console.log("bokalSourage wiped out keys: ",t)}remove(t){return r.removeItem(`${this.prefix}${t}`)}watch(t,e){const s=this._cbs[t];return s?s.push(e):this._cbs[t]=[e],()=>this.unwatch(t,e)}unwatch(t,e){const s=this._cbs[t],i=s.indexOf(e);return i<0?!1:(s.splice(i,1),!0)}subscribe(t,e){return this.watch(`message:${t}`,e)}publish(t,e){return this.set(`message:${t}`,e===void 0?null:JSON.stringify(e))}}export default h;
